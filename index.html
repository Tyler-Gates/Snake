<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" type="text/css" href="styling.css" />
  </head>
  <body>
    <div>
      <img class="title" src="img/title.png" />
      <img class="title-snake" src="img/snake.png" />
    </div>
    <canvas
      id="snake-game"
      class="snake-canvas"
      width="800"
      height="800"
    ></canvas>
    <div class="button-option-list">
      <div class="apple-count-label">
        <img src="img/appleCount.png" />
        <span id="apple-count"></span>
      </div>
      <img
        src="img/minus.png"
        id="remove-apple-button"
        onclick="appleCountManipulator(false)"
      /><img
        src="img/plus.png"
        id="add-apple-button"
        onclick="appleCountManipulator(true)"
      />
    </div>

    <script>
      const canvas = document.getElementById("snake-game");
      const ctx = canvas.getContext("2d");
      var snakeDirection = "right";
      var snakePositions = [[5, 0]];
      var moveLock = false;
      var queuedMove = "";
      var appleCount = 1;
      var startGameFlag = false;
      var eatenFoodFlag = true;
      var aliveFlag = true;
      var restartFlag = false;
      const gameOver = new Image();
      gameOver.src = "img/gameover.png";

      const pressRToRestart1 = new Image();
      pressRToRestart1.src = "img/pressR1.png";

      const pressRToRestart2 = new Image();
      pressRToRestart2.src = "img/pressR2.png";

      const controls = new Image();
      controls.src = "img/controls.png";

      const one = new Image();
      one.src = "img/one.png";

      const two = new Image();
      two.src = "img/two.png";

      const three = new Image();
      three.src = "img/three.png";

      const four = new Image();
      four.src = "img/four.png";

      const five = new Image();
      five.src = "img/five.png";

      const six = new Image();
      six.src = "img/six.png";

      const seven = new Image();
      seven.src = "img/seven.png";

      const eight = new Image();
      eight.src = "img/eight.png";

      const nine = new Image();
      nine.src = "img/nine.png";

      const zero = new Image();
      zero.src = "img/zero.png";

      ctx.fillStyle = "#3f4f38";
      ctx.fillRect(0, 0, 800, 800);

      var gameState = Array.from(Array(20), () => new Array(20).fill(0));
      gameState[5][0] = 1;

      const drawAppleCountList = document.getElementById("apple-count");

      document.getElementById("apple-count").value = appleCount;
      drawAppleCount();
      function appleCountManipulator(change) {
        appleCount = document.getElementById("apple-count").value;
        if (change) {
          appleCount++;
        } else if (appleCount > 1) {
          appleCount--;
        }
        document.getElementById("apple-count").value = appleCount;
        drawAppleCount();
      }

      function drawAppleCount() {
        const appleCountString = appleCount.toString();
        drawAppleCountList.innerHTML = "";
        for (var i = 0; i < appleCountString.length; i++) {
          switch (appleCountString[i]) {
            case "0":
              drawAppleCountList.appendChild(zero.cloneNode(true));
              break;
            case "1":
              drawAppleCountList.appendChild(one.cloneNode(true));
              break;
            case "2":
              drawAppleCountList.appendChild(two.cloneNode(true));
              break;
            case "3":
              drawAppleCountList.appendChild(three.cloneNode(true));
              break;
            case "4":
              drawAppleCountList.appendChild(four.cloneNode(true));
              break;
            case "5":
              drawAppleCountList.appendChild(five.cloneNode(true));
              break;
            case "6":
              drawAppleCountList.appendChild(six.cloneNode(true));
              break;
            case "7":
              drawAppleCountList.appendChild(seven.cloneNode(true));
              break;
            case "8":
              drawAppleCountList.appendChild(eight.cloneNode(true));
              break;
            case "9":
              drawAppleCountList.appendChild(nine.cloneNode(true));
              break;
          }
        }
      }

      window.addEventListener("keydown", handleKeyPress);

      function handleKeyPress(event) {
        switch (event.keyCode) {
          case 39:
          case 68:
            if (snakeDirection != "left") {
              if (!moveLock) {
                moveLock = true;
                snakeDirection = "right";
              } else {
                queuedMove = "right";
              }
            }
            break;
          case 37:
          case 65:
            if (snakeDirection != "right") {
              if (!moveLock) {
                moveLock = true;
                snakeDirection = "left";
              } else {
                queuedMove = "left";
              }
            }
            break;
          case 38:
          case 87:
            if (snakeDirection != "down") {
              if (!moveLock) {
                moveLock = true;
                snakeDirection = "up";
              } else {
                queuedMove = "up";
              }
            }
            break;
          case 40:
          case 83:
            if (snakeDirection != "up") {
              if (!moveLock) {
                moveLock = true;
                snakeDirection = "down";
              } else {
                queuedMove = "down";
              }
            }
            break;
          case 82:
            if (!aliveFlag) {
              restartFlag = true;
            }
            break;
          case 32:
            if (aliveFlag) {
              startGameFlag = !startGameFlag;
            }
        }
      }

      function drawState() {
        for (var i = 0; i < 20; i++) {
          for (var j = 0; j < 20; j++) {
            switch (gameState[j][i]) {
              case 0:
                ctx.fillStyle = "#3f4f38";
                break;
              case 1:
                ctx.fillStyle = "#402d33";
                break;
              case 2:
                ctx.fillStyle = "#661e1e";
                break;
            }
            ctx.fillRect(i * 40, j * 40, 40, 40);
          }
        }
      }

      function updateState() {
        if (!moveLock && queuedMove != "") {
          snakeDirection = queuedMove;
          queuedMove = "";
        }
        switch (snakeDirection) {
          case "right":
            if (+snakePositions[0][1] + 1 < 20) {
              if (
                gameState[snakePositions[0][0]][+snakePositions[0][1] + 1] == 0
              ) {
                var newPosition = [
                  snakePositions[0][0],
                  +snakePositions[0][1] + 1,
                ];
                var oldPosition = snakePositions.pop();
                gameState[oldPosition[0]][oldPosition[1]] = 0;
                snakePositions.unshift(newPosition);
                gameState[snakePositions[0][0]][snakePositions[0][1]] = 1;
              } else if (
                gameState[snakePositions[0][0]][+snakePositions[0][1] + 1] == 2
              ) {
                eatenFoodFlag = true;
                snakePositions.unshift([
                  [snakePositions[0][0]],
                  [+snakePositions[0][1] + 1],
                ]);
                gameState[snakePositions[0][0]][snakePositions[0][1]] = 1;
              } else {
                aliveFlag = false;
              }
            } else {
              aliveFlag = false;
            }
            break;
          case "left":
            if (+snakePositions[0][1] - 1 >= 0) {
              if (
                gameState[snakePositions[0][0]][+snakePositions[0][1] - 1] == 0
              ) {
                var newPosition = [
                  snakePositions[0][0],
                  +snakePositions[0][1] - 1,
                ];
                var oldPosition = snakePositions.pop();
                gameState[oldPosition[0]][oldPosition[1]] = 0;
                snakePositions.unshift(newPosition);
                gameState[snakePositions[0][0]][snakePositions[0][1]] = 1;
              } else if (
                gameState[snakePositions[0][0]][+snakePositions[0][1] - 1] == 2
              ) {
                eatenFoodFlag = true;
                snakePositions.unshift([
                  [snakePositions[0][0]],
                  [+snakePositions[0][1] - 1],
                ]);
                gameState[snakePositions[0][0]][snakePositions[0][1]] = 1;
              } else {
                aliveFlag = false;
              }
            } else {
              aliveFlag = false;
            }
            break;
          case "down":
            if (+snakePositions[0][0] + 1 < 20) {
              if (
                gameState[+snakePositions[0][0] + 1][snakePositions[0][1]] == 0
              ) {
                var newPosition = [
                  +snakePositions[0][0] + 1,
                  snakePositions[0][1],
                ];
                var oldPosition = snakePositions.pop();
                gameState[oldPosition[0]][oldPosition[1]] = 0;
                snakePositions.unshift(newPosition);
                gameState[snakePositions[0][0]][snakePositions[0][1]] = 1;
              } else if (
                gameState[+snakePositions[0][0] + 1][snakePositions[0][1]] == 2
              ) {
                eatenFoodFlag = true;
                snakePositions.unshift([
                  [+snakePositions[0][0] + 1],
                  [snakePositions[0][1]],
                ]);
                gameState[snakePositions[0][0]][snakePositions[0][1]] = 1;
              } else {
                aliveFlag = false;
              }
            } else {
              aliveFlag = false;
            }
            break;
          case "up":
            if (+snakePositions[0][0] - 1 >= 0) {
              if (
                gameState[+snakePositions[0][0] - 1][snakePositions[0][1]] == 0
              ) {
                var newPosition = [
                  +snakePositions[0][0] - 1,
                  snakePositions[0][1],
                ];
                var oldPosition = snakePositions.pop();
                gameState[oldPosition[0]][oldPosition[1]] = 0;
                snakePositions.unshift(newPosition);
                gameState[snakePositions[0][0]][snakePositions[0][1]] = 1;
              } else if (
                gameState[+snakePositions[0][0] - 1][snakePositions[0][1]] == 2
              ) {
                eatenFoodFlag = true;
                snakePositions.unshift([
                  [+snakePositions[0][0] - 1],
                  [snakePositions[0][1]],
                ]);
                gameState[snakePositions[0][0]][snakePositions[0][1]] = 1;
              } else {
                aliveFlag = false;
              }
            } else {
              aliveFlag = false;
            }
            break;
        }

        moveLock = false;
      }

      function generateNewFood() {
        while (eatenFoodFlag && appleCount >= 0) {
          let x = Math.floor(Math.random() * 20);
          let y = Math.floor(Math.random() * 20);
          if (gameState[x][y] == 0) {
            gameState[x][y] = 2;
            appleCount--;
            if (appleCount == 0) {
              appleCount++;
              eatenFoodFlag = false;
            }
          }
        }
      }

      function drawGameOver() {
        ctx.drawImage(gameOver, 185, 200);
        ctx.drawImage(pressRToRestart1, 195, 410);
      }

      function restartGame() {
        gameState = Array.from(Array(20), () => new Array(20).fill(0));
        eatenFoodFlag = true;
        aliveFlag = true;
        queuedMove = [];
        restartFlag = false;
        gameState[5][0] = 1;
        snakeDirection = "right";
        snakePositions = [[5, 0]];
        appleCount = document.getElementById("apple-count").value;
        generateNewFood();
        drawState();
      }

      function gameLoop() {
        setTimeout(() => {
          if (startGameFlag) {
            if (aliveFlag) {
              if (eatenFoodFlag) {
                generateNewFood();
              }
              updateState();
              drawState();
            } else {
              if (restartFlag) {
                restartGame();
              }
              drawGameOver();
            }
          } else {
            ctx.drawImage(controls, 200, 200);
          }
          requestAnimationFrame(gameLoop);
        }, 1000 / 20);
      }
      requestAnimationFrame(gameLoop);
    </script>
  </body>
</html>
